{"version":3,"names":["ControllableModuleType","Logger","LocalParticipant","CallsEvent","GroupCallEventType","SendbirdError","Room","poolRelease","pool","get","binder","props","roomId","room","_updateInternal","constructor","emit","event","args","_internalEvents","forEach","listener","add","push","index","indexOf","debug","unsubscribes","disposeInternal","disposeNative","_binder","addListener","GROUP_CALL","type","data","additionalData","ON_DELETED","onDeleted","ON_ERROR","error","errorMessage","errorCode","participant","onError","ON_REMOTE_PARTICIPANT_ENTERED","onRemoteParticipantEntered","ON_REMOTE_PARTICIPANT_EXITED","onRemoteParticipantExited","ON_REMOTE_PARTICIPANT_STREAM_STARTED","onRemoteParticipantStreamStarted","ON_AUDIO_DEVICE_CHANGED","onAudioDeviceChanged","currentAudioDevice","availableAudioDevices","ON_REMOTE_VIDEO_SETTINGS_CHANGED","onRemoteVideoSettingsChanged","ON_REMOTE_AUDIO_SETTINGS_CHANGED","onRemoteAudioSettingsChanged","ON_CUSTOM_ITEMS_UPDATED","onCustomItemsUpdated","updatedKeys","ON_CUSTOM_ITEMS_DELETED","onCustomItemsDeleted","deletedKeys","fn","options","audioEnabled","videoEnabled","nativeModule","enter","device","selectAudioDevice","_props","_localParticipant","localParticipant","state","customItems","participants","remoteParticipants","android_availableAudioDevices","android_currentAudioDevice","createdAt","createdBy","exit"],"sources":["Room.ts"],"sourcesContent":["import type { AudioDevice, EnterParams, GroupCallMethods, RoomListener, RoomProperties } from '../types';\nimport { ControllableModuleType } from '../types';\nimport { Logger } from '../utils/logger';\nimport { LocalParticipant } from './LocalParticipant';\nimport type NativeBinder from './NativeBinder';\nimport { CallsEvent, GroupCallEventType } from './NativeBinder';\nimport { SendbirdError } from './SendbirdError';\n\nexport interface InternalEvents<T> {\n  pool: Partial<T>[];\n  emit: (event: keyof T, ...args: unknown[]) => void;\n  add: (listener: Partial<T>) => () => void;\n}\n\nexport class Room implements RoomProperties, GroupCallMethods {\n  /** @internal **/\n  private static pool: Record<string, Room> = {};\n\n  /** @internal **/\n  public static poolRelease() {\n    Room.pool = {};\n  }\n\n  /** @internal **/\n  public static get(binder: NativeBinder, props: RoomProperties) {\n    if (!Room.pool[props.roomId]) Room.pool[props.roomId] = new Room(binder, props);\n    const room = Room.pool[props.roomId];\n    return room._updateInternal(props);\n  }\n\n  constructor(binder: NativeBinder, props: RoomProperties) {\n    this._binder = binder;\n    this._props = props;\n    this._localParticipant = null;\n  }\n\n  private _binder: NativeBinder;\n  private _props: RoomProperties;\n  private _localParticipant: LocalParticipant | null;\n  private _internalEvents = {\n    pool: [] as Partial<RoomListener>[],\n    emit: (event: keyof RoomListener, ...args: unknown[]) => {\n      // @ts-ignore\n      this._internalEvents.pool.forEach((listener) => listener[event]?.(...args));\n    },\n    add: (listener: Partial<RoomListener>) => {\n      this._internalEvents.pool.push(listener);\n      return () => {\n        const index = this._internalEvents.pool.indexOf(listener);\n        if (index > -1) delete this._internalEvents.pool[index];\n      };\n    },\n  };\n  private _updateInternal(props: RoomProperties) {\n    this._localParticipant = LocalParticipant.get(\n      this._binder,\n      this._internalEvents,\n      props.localParticipant,\n      this.roomId,\n    );\n    this._props = props;\n    return this;\n  }\n\n  public get roomId() {\n    return this._props.roomId;\n  }\n  public get state() {\n    return this._props.state;\n  }\n  public get type() {\n    return this._props.type;\n  }\n  public get customItems() {\n    return this._props.customItems;\n  }\n  public get participants() {\n    return this._props.participants;\n  }\n  public get localParticipant() {\n    return this._localParticipant;\n  }\n  public get remoteParticipants() {\n    return this._props.remoteParticipants;\n  }\n  public get android_availableAudioDevices() {\n    return this._props.android_availableAudioDevices;\n  }\n  public get android_currentAudioDevice() {\n    return this._props.android_currentAudioDevice;\n  }\n  public get createdAt() {\n    return this._props.createdAt;\n  }\n  public get createdBy() {\n    return this._props.createdBy;\n  }\n\n  /**\n   * Add GroupCall Room listener.\n   * supports multiple listeners.\n   *\n   * @since 1.0.0\n   */\n  public addListener = (listener: Partial<RoomListener>) => {\n    Logger.debug('[GroupCall]', 'addListener', this.roomId);\n\n    const unsubscribes: Array<() => void> = [];\n\n    const disposeInternal = this._internalEvents.add(listener);\n\n    const disposeNative = this._binder.addListener(CallsEvent.GROUP_CALL, ({ type, data, additionalData }) => {\n      if (data.roomId !== this.roomId) return;\n\n      Logger.debug('[GroupCall]', 'receive events ', type, data.roomId, additionalData);\n      this._updateInternal(data);\n      switch (type) {\n        case GroupCallEventType.ON_DELETED: {\n          listener.onDeleted?.();\n          break;\n        }\n        case GroupCallEventType.ON_ERROR: {\n          const error = new SendbirdError(additionalData?.errorMessage, additionalData?.errorCode);\n          const participant = additionalData?.participant;\n          listener.onError?.(error, participant);\n          break;\n        }\n        case GroupCallEventType.ON_REMOTE_PARTICIPANT_ENTERED: {\n          listener.onRemoteParticipantEntered?.(additionalData?.participant);\n          break;\n        }\n        case GroupCallEventType.ON_REMOTE_PARTICIPANT_EXITED: {\n          listener.onRemoteParticipantExited?.(additionalData?.participant);\n          break;\n        }\n        case GroupCallEventType.ON_REMOTE_PARTICIPANT_STREAM_STARTED: {\n          listener.onRemoteParticipantStreamStarted?.(additionalData?.participant);\n          break;\n        }\n        case GroupCallEventType.ON_AUDIO_DEVICE_CHANGED: {\n          listener.onAudioDeviceChanged?.(\n            additionalData?.currentAudioDevice ?? null,\n            additionalData?.availableAudioDevices ?? [],\n          );\n          break;\n        }\n        case GroupCallEventType.ON_REMOTE_VIDEO_SETTINGS_CHANGED: {\n          listener.onRemoteVideoSettingsChanged?.(additionalData?.participant);\n          break;\n        }\n        case GroupCallEventType.ON_REMOTE_AUDIO_SETTINGS_CHANGED: {\n          listener.onRemoteAudioSettingsChanged?.(additionalData?.participant);\n          break;\n        }\n        case GroupCallEventType.ON_CUSTOM_ITEMS_UPDATED: {\n          listener.onCustomItemsUpdated?.(additionalData?.updatedKeys ?? []);\n          break;\n        }\n        case GroupCallEventType.ON_CUSTOM_ITEMS_DELETED: {\n          listener.onCustomItemsDeleted?.(additionalData?.deletedKeys ?? []);\n          break;\n        }\n      }\n    });\n\n    unsubscribes.push(disposeNative, disposeInternal);\n    return () => unsubscribes.forEach((fn) => fn());\n  };\n\n  /**\n   * Enter the room\n   * Will trigger {@link RoomListener.onRemoteParticipantEntered} method of remote participants after successfully entering the room.\n   * If a remote participant entered the room, the local user will be notified via the same method.\n   *\n   * @since 1.0.0\n   */\n  public enter = (options: EnterParams = { audioEnabled: true, videoEnabled: true }) => {\n    return this._binder.nativeModule.enter(this.roomId, options);\n  };\n\n  /**\n   * Exit from the room\n   * Will trigger {@link RoomListener.onRemoteParticipantExited} method of remote participants after successfully exiting the room.\n   * If a remote participant exited the room, the local user will be notified via the same method.\n   *\n   * @since 1.0.0\n   */\n  public exit() {\n    this._binder.nativeModule.exit(this.roomId);\n  }\n\n  /**\n   * Selects audio device\n   * Changes current audio device asynchronously.\n   * Will trigger {@link RoomListener.onAudioDeviceChanged} method of the local participant after successfully changing the audio device.\n   *\n   * @platform Android\n   * @since 1.0.0\n   */\n  public android_selectAudioDevice = (device: AudioDevice) => {\n    return this._binder.nativeModule.selectAudioDevice(ControllableModuleType.GROUP_CALL, this.roomId, device);\n  };\n}\n"],"mappings":"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"}